function LayaExtendClass(){Laya.Stage.prototype.sResize=new Signal,window.Vector2=Laya.Vector2,window.Vector3=Laya.Vector3,window.Vector4=Laya.Vector4}function LayaExtendLogic(){if(Laya.stage.on(Laya.Event.RESIZE,null,function(){Laya.stage.sResize.dispatch()}),Laya.MiniSoundChannel&&!Laya.MiniSoundChannel.__IsReplaceFun){Laya.MiniSoundChannel.__IsReplaceFun=!0;var n=Laya.SoundManager,a=Laya.MiniSound,e=Laya.MiniSoundChannel,o=Laya.MiniAdpter,t=Laya.MiniFileMgr;n.__soundChannelCache=new Map,n.getSoundChannelCache=function(a){if(!n.__soundChannelCache.has(a))return null;var e=n.__soundChannelCache.get(a);if(0==e.length)return null;var o=e.shift();return o._audio?o:null},n.addSoundChannelCache=function(a){var e,o=a.url;n.__soundChannelCache.has(o)?e=n.__soundChannelCache.get(o):(e=[],n.__soundChannelCache.set(o,e)),e.push(a)},n.preloadSound=function(a,e=null){return n._isActive&&a?n._muted?null:(a=Laya.URL.formatURL(a))==n._bgMusic&&n._musicMuted?null:(e||(e=n._soundClass),o||(o=new e).load(a),(t=o.preloadSound())?(t.url=a,t.volume=a==n._bgMusic?n.musicVolume:n.soundVolume,o):null):null;var o,t},a.prototype.preloadSound=function(){var i;if(this.url==Laya.SoundManager._bgMusic?(a._musicAudio||(a._musicAudio=a._createSound()),i=a._musicAudio):i=a._audioCache[this.readyUrl]?a._audioCache[this.readyUrl]._sound:a._createSound(),!i)return null;if(o.autoCacheFile&&t.getFileInfo(this.url)){var u=t.getFileInfo(this.url).md5;i.src=this.url=t.getFileNativePath(u)}else i.src=this.url;var l=new e(i,this);return l.url=this.readyUrl,l.loops=1,l.loop=!1,l.startTime=0,i.stop(),n.addSoundChannelCache(l),l},a.prototype.onCanPlaySrc=a.prototype.onCanPlay,a.prototype.onCanPlay=function(){this.onCanPlaySrc(),this.dispose()},n.playSoundSrc=Laya.SoundManager.playSound,n.playSound=function(a,e=1,o=null,t=null,i=0){if(!n._isActive||!a)return null;if(n._muted)return null;if((a=Laya.URL.formatURL(a))==n._bgMusic&&n._musicMuted)return null;var u=n.getSoundChannelCache(a);return u?(u.volume=a==n._bgMusic?n.musicVolume:n.soundVolume,u.completeHandler=o,u.play(),u):n.playSoundSrc(a,e,o,t,i)},Laya.MiniSoundChannel.prototype.__onEndSrc=Laya.MiniSoundChannel.prototype.__onEnd,Laya.MiniSoundChannel.prototype.__onEnd=function(n){1==this.loops?(this.completeHandler&&(Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(!1),this.event(Laya.Event.COMPLETE)):this.__onEndSrc(n)},Laya.MiniSoundChannel.prototype.stopSrc=Laya.MiniSoundChannel.prototype.stop,Laya.MiniSoundChannel.prototype.stop=function(a=!0){this.isStopped=!0,Laya.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),a?this.loop||(this._audio.offEnded(null),this._miniSound.dispose(),this._audio=null,this._miniSound=null,this._onEnd=null):n.addSoundChannelCache(this))}}}window.LayaExtendClass=LayaExtendClass,window.LayaExtendLogic=LayaExtendLogic;